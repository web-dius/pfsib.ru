(function($,undefined){"use strict";var _window=window,_document=document,_undefined=undefined;$us.PageScroller=function(container,options){this.init(container,options)};$us.PageScroller.prototype={init:function(container,options){var defaults={coolDown:100,animationDuration:1000,animationEasing:$us.getAnimationName('easeInOutExpo'),endAnimationEasing:$us.getAnimationName('easeOutExpo'),};this.options=$.extend({},defaults,options);this.$container=$(container);this.activeSection=0;this.sections=[];this.initialSections=[];this.hiddenSections=[];this.currHidden=[];this.dots=[];this.scrolls=[];this.usingDots=!1;this.footerReveal=$us.$body.hasClass('footer_reveal');this.isTouch=(('ontouchstart' in _window)||(navigator.msMaxTouchPoints>0)||(navigator.maxTouchPoints));this.disableWidth=(this.$container.data('disablewidth')!==_undefined)?this.$container.data('disablewidth'):768;this.hiddenClasses={'uvc_hidden-xs':[0,479],'uvc_hidden-xsl':[480,767],'uvc_hidden-sm':[768,991],'uvc_hidden-md':[992,1199],'uvc_hidden-ml':[1200,1823],'uvc_hidden-lg':[1824,99999],'vc_hidden-xs':[0,767],'vc_hidden-sm':[768,991],'vc_hidden-md':[992,1199],'vc_hidden-lg':[1200,99999],};if(this.$container.data('speed')!==_undefined){this.options.animationDuration=this.$container.data('speed')}
this._events={destroy:this._destroy.bind(this),mouseWheelHandler:this._mouseWheelHandler.bind(this),resize:this.resize.bind(this),scroll:this.scroll.bind(this)};this._attachEvents();this.$container.on('usb.removeHtml',this._events.destroy)
$us.$canvas.on('contentChange',$us.debounce(this._events.resize,5));var _resize=$us.debounce(this._events.resize,50);$us.$window.on('scroll',$us.debounce(this._events.scroll,5)).on('resize',function(_,stopExecute){if(!stopExecute){_resize()}});$us.timeout(this._init.bind(this),100)},is_popup:function(){return $us.$html.hasClass('usoverlay_fixed')},_add_dynamic_breakpoints:function(){var custom_breakpoints=$us.responsiveBreakpoints,default_breakpoints={'hide_on_mobiles':[0,767],'hide_on_tablets':[768,991],'hide_on_laptops':[992,1199],'hide_on_default':[1200,99999],};if(custom_breakpoints){default_breakpoints={'hide_on_mobiles':[0,custom_breakpoints.mobiles],'hide_on_tablets':[(custom_breakpoints.mobiles+1),custom_breakpoints.tablets],'hide_on_laptops':[(custom_breakpoints.tablets+1),custom_breakpoints.laptops],'hide_on_default':[(custom_breakpoints.laptops+1),9999]}}
this.hiddenClasses=Object.assign(this.hiddenClasses,default_breakpoints)},_init:function(){if($us.header.isStatic()&&$us.header.isHorizontal()&&!$us.header.isTransparent()){$us.canvas.$header.each(function(){var $section=$us.canvas.$header,section={$section:$section,area:'header',};this._countPosition(section);this.sections.push(section);this.initialSections.push(section)}.bind(this))}
this._add_dynamic_breakpoints();$('> *:not(.l-header) .l-section',$us.$canvas).each(function(key,elm){var $section=$(elm),isPopupContent=!!$section.closest('.w-popup').length,isPopupWrapper=!!$section.find('.w-popup .l-section').length;if(isPopupContent||($section.parents('.l-section').length&&!isPopupWrapper)){return}
var section={$section:$section,hiddenBoundaries:[],area:'content',isSticky:$section.hasClass('type_sticky')},addedWidths=[];hidden:for(var i in this.hiddenClasses){if(this.hiddenClasses.hasOwnProperty(i)){var low=this.hiddenClasses[i][0],high=this.hiddenClasses[i][1];if($section.hasClass(i)){var addedWidthLength=addedWidths.length,j;addedWidths.push([low,high]);for(j=0;j<addedWidthLength;j ++){if(addedWidths[j][0]===low&&addedWidths[j][1]===high){break hidden}}
section.hiddenBoundaries.push([low,high]);if(this.hiddenSections.indexOf(key)===-1){this.hiddenSections.push(key)}}}}
this._countPosition(section,key);this.sections.push(section);this.initialSections.push(section)}.bind(this));this.lastContentSectionIndex=this.sections.length-1;$('.l-footer > .l-section').each(function(key,elm){var $section=$(elm),section={$section:$section,area:'footer',isSticky:$section.hasClass('type_sticky')};this._countPosition(section,key);this.sections.push(section);this.initialSections.push(section)}.bind(this));this.$dotsContainer=this.$container.find('.w-scroller-dots');if(this.$dotsContainer.length){this.usingDots=!0;this.$firstDot=this.$dotsContainer.find('.w-scroller-dot').first();this.redrawDots(!0);this.scroll()}
$us.timeout(this.resize.bind(this),100)},_destroy:function(){var self=this;$us.$document.off('mousewheel DOMMouseScroll MozMousePixelScroll');_document.removeEventListener('mousewheel',self._events.mouseWheelHandler);_document.removeEventListener('DOMMouseScroll',self._events.mouseWheelHandler);_document.removeEventListener('MozMousePixelScroll',self._events.mouseWheelHandler);$us.$canvas.off('touchstart touchmove')},isSectionHidden:function(section){if(!this.initialSections[section].hiddenBoundaries||!this.initialSections[section].hiddenBoundaries.length){return!1}
var currWidth=_window.innerWidth,isHidden=!1;for(var i=0;i<this.initialSections[section].hiddenBoundaries.length;i ++){var low=this.initialSections[section].hiddenBoundaries[i][0],high=this.initialSections[section].hiddenBoundaries[i][1];if(currWidth>=low&&currWidth<=high){isHidden=!0;break}}
return isHidden},redrawDots:function(inited){if(!this.usingDots||!this.$dotsContainer||!this.$dotsContainer.length){return!1}
this.$dotsContainer.html('');for(var i=0;i<this.sections.length;i ++){if(this.sections[i].area==='footer'&&!this.$container.data('footer-dots')){continue}
this.$firstDot.clone().appendTo(this.$dotsContainer)}
this.$dots=this.$dotsContainer.find('.w-scroller-dot');this.$dots.each(function(key,elm){var $dot=$(elm);this.dots[key]=$dot;$dot.click(function(){this.scrollTo(key);this.$dots.removeClass('active');$dot.addClass('active')}.bind(this)).toggleClass('hidden',this.sections[key].isSticky&&$us.$window.width()>$us.canvas.options.columnsStackingWidth)}.bind(this));if(!!inited&&this.dots[this.activeSection]){this.dots[this.activeSection].addClass('active')}
this.$dotsContainer.addClass('show')},recountSections:function(){if(this.currHidden){for(var initialSection in this.initialSections){this.sections[initialSection]=this.initialSections[initialSection]}}
for(var i=this.hiddenSections.length-1;i>=0;i --){var indexOfTheItem=this.currHidden.indexOf(this.hiddenSections[i]);if(this.isSectionHidden(this.hiddenSections[i])){if(indexOfTheItem===-1){this.currHidden.push(this.hiddenSections[i])}
this.sections.splice(this.hiddenSections[i],1)}else{this.currHidden.splice(indexOfTheItem,1)}}
this.redrawDots(!0)},getScrollSpeed:function(number){var sum=0,lastElements=this.scrolls.slice(Math.max(this.scrolls.length-number,1));for(var i=0;i<lastElements.length;i ++){sum=sum+lastElements[i]}
return Math.ceil(sum/number)},_mouseWheelHandler:function(e){var self=this;if($us.usbPreview()||self.is_popup()){return}
e.preventDefault();var currentTime=new Date().getTime(),target=self.activeSection,direction=e.wheelDelta||-e.detail,speedEnd,speedMiddle,isAccelerating;if(self.scrolls.length>149){self.scrolls.shift()}
self.scrolls.push(Math.abs(direction));if((currentTime-self.previousMouseWheelTime)>self.options.coolDown){self.scrolls=[]}
self.previousMouseWheelTime=currentTime;speedEnd=self.getScrollSpeed(10);speedMiddle=self.getScrollSpeed(70);isAccelerating=speedEnd>=speedMiddle;if(isAccelerating){if(direction<0){target ++}else if(direction>0){target --}
if(self.sections[target]===_undefined){return}
self.scrollTo(target);self.lastScroll=currentTime}},_attachEvents:function(){var self=this;self._destroy();if($us.$window.width()>self.disableWidth&&$us.mobileNavOpened<=0&&(!$us.$html.hasClass('cloverlay_fixed'))){_document.addEventListener('mousewheel',self._events.mouseWheelHandler,{passive:!1});_document.addEventListener('DOMMouseScroll',self._events.mouseWheelHandler,{passive:!1});_document.addEventListener('MozMousePixelScroll',self._events.mouseWheelHandler,{passive:!1});if($.isMobile||self.isTouch){$us.$canvas.on('touchstart',function(event){var e=event.originalEvent;if(typeof e.pointerType==='undefined'||e.pointerType!=='mouse'){self.touchStartY=e.touches[0].pageY}});$us.$canvas.on('touchmove',function(event){event.preventDefault();var currentTime=new Date().getTime(),e=event.originalEvent,target=self.activeSection;self.touchEndY=e.touches[0].pageY;if(Math.abs(self.touchStartY-self.touchEndY)>($us.$window.height()/50)){if(self.touchStartY>self.touchEndY){target ++}else if(self.touchEndY>self.touchStartY){target --}
if(self.sections[target]===_undefined){return}
self.scrollTo(target);self.lastScroll=currentTime}})}}},_countPosition:function(section,key){section.top=section.$section.offset().top-$us.canvas.getOffsetTop();if(this.footerReveal&&section.area==='footer'&&key!==_undefined){if(_window.innerWidth>parseInt($us.canvasOptions.columnsStackingWidth)-1){if(this.sections[key-1]!==_undefined&&this.sections[key-1].area==='footer'){section.top=this.sections[key-1].bottom}else{var rowIndex=(this.sections[this.lastContentSectionIndex+key]!==_undefined)?this.lastContentSectionIndex+key:key-1;section.top=this.sections[rowIndex].bottom}}}
section.bottom=section.top+section.$section.outerHeight(!1)},_countAllPositions:function(){var counter=0;for(var section in this.sections){if(this.sections[section].$section.length){this._countPosition(this.sections[section],counter)}
counter ++}},scrollTo:function(target){var currentTime=new Date().getTime();if(this.previousScrollTime!==_undefined&&(currentTime-this.previousScrollTime<this.options.animationDuration)){return}
this.previousScrollTime=currentTime;if(this.sections[target].isSticky&&$us.$window.width()>$us.canvas.options.columnsStackingWidth){if(target>this.activeSection){target+=1}else{target-=1}}
if(this.usingDots){this.$dots.removeClass('active');if(this.dots[target]!==_undefined){this.dots[target].addClass('active')}}
var top=Math.ceil(this.sections[target].top||0);if(top===Math.ceil($us.header.getScrollTop())){return}
var animateOptions={duration:this.options.animationDuration,easing:this.options.animationEasing,start:function(){this.isScrolling=!0}.bind(this),always:function(){this.isScrolling=!1;this.activeSection=target}.bind(this),step:function(now,fx){var newTop=top;if($us.header.isStickyEnabled()){newTop-=$us.header.getCurrentHeight(!0)}
if(fx.end!==newTop){$us.$htmlBody.stop(!0,!1).animate({scrollTop:newTop},$.extend(animateOptions,{easing:this.options.endAnimationEasing}))}}.bind(this)};$us.$htmlBody.stop(!0,!1).animate({scrollTop:top},animateOptions)},resize:function(e){if(this.is_popup()){return!1}
this._attachEvents();this.recountSections();$us.timeout(this._countAllPositions.bind(this),150)},scroll:function(){if(this.is_popup()){return!1}
var currentTime=new Date().getTime();if((currentTime-this.lastScroll)<(this.options.coolDown+this.options.animationDuration)){return}
$us.debounce(function(){var scrollTop=$us.parseInt($us.$window.scrollTop());if($us.header.isSticky()){scrollTop+=$us.header.getCurrentHeight(!0)}
for(var index in this.sections){var section=this.sections[index];if(scrollTop>=$us.parseInt(section.top-1)&&scrollTop<$us.parseInt(section.bottom-1)&&section.area==='content'&&this.activeSection!==index&&!section.hiddenBoundaries){this.activeSection=index}}
if(this.usingDots){this.$dots.removeClass('active');if(this.dots[this.activeSection]!==_undefined){this.dots[this.activeSection].addClass('active')}}}.bind(this),500)()}};$.fn.usPageScroller=function(options){return this.each(function(){$(this).data('usPageScroller',new $us.PageScroller(this,options))})};$(function(){$us.timeout(function(){$('.w-scroller').usPageScroller()},0)})})(jQuery)