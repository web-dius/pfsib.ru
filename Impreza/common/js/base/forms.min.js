!function($,undefined){var _window=window,_document=document,_undefined=undefined;_window.$us=_window.$us||{};$us.WForm=function(container){var self=this;self.$form=$(container);if(!self.$form.hasClass('for_cform')){self.$form=$('.w-form.for_cform',container)}
self.$dateFields=$('.w-form-row.for_date input',self.$form);self.$message=$('.w-form-message',self.$form);self.$submit=$('.w-btn',self.$form);self.options={};self.isFileValid=!0;self.pickerOptions={};var $formJson=$('.w-form-json',self.$form);if($formJson.is('[onclick]')){self.options=$formJson[0].onclick()||{};if(!$us.usbPreview()){$formJson.remove()}}
if(self.$dateFields.length){$(function(){self._initDateField()})}
$('input[type=text],\
			input[type=email],\
			input[type=tel],\
			input[type=number],\
			input[type=date],\
			input[type=search],\
			input[type=url],\
			input[type=password],\
			textarea',self.$form).each(function(_,input){var $input=$(input),$row=$input.closest('.w-form-row');if($input.attr('type')==='hidden'){return}
$row.toggleClass('not-empty',$input.val()!='');$input.on('input change',function(){$row.toggleClass('not-empty',$input.val()!='')})});self._events={changeFile:self._changeFile.bind(self),submit:self._submit.bind(self)};self.$form.on('change','input[type=file]:visible',self._events.changeFile).on('submit',self._events.submit)};$.extend($us.WForm.prototype,{getExtension:function(name){return(''+name).split('.').pop()},_validExtension:function(file,accepts){if(!accepts){return!0}
var self=this;accepts=(''+accepts).split(',');for(var i in accepts){var accept=(''+accepts[i]).trim();if(!accept){continue}
if(accept.indexOf('/')>-1){var acceptMatches=accept.split('/');if(file.type===accept||(acceptMatches[1]==='*'&&(''+file.type).indexOf(acceptMatches[0])===0)){return!0}}else if(self.getExtension(file.name)===accept.replace(/[^A-z\d]+/,'')){return!0}}
return!1},_requiredValidation:function(){var self=this;var errors=0;$('[data-required=true]',self.$form).each(function(_,input){var $input=$(input),isEmpty=$input.is('[type=checkbox]')?!$input.is(':checked'):$input.val()=='',$row=$input.closest('.w-form-row');if($row.hasClass('for_checkboxes')){return!0}
if(input.type==='file'){isEmpty=isEmpty||!self.isFileValid}
$row.toggleClass('check_wrong',isEmpty);if(isEmpty){errors ++}});$('.for_checkboxes.required',self.$form).each(function(_,elm){var $input=$('input[type=checkbox]',elm),$row=$input.closest('.w-form-row'),isEmpty=!$input.is(':checked');$row.toggleClass('check_wrong',isEmpty);if(isEmpty){errors ++}});return!errors},_initDateField:function(){var self=this;$.each(self.$dateFields,function(_,input){var $input=$(input);self.pickerOptions.dateFormat=$input.data('date-format');self.pickerOptions.onClose=function(){$input.closest('.w-form-row').removeClass('focused')};$input.datepicker(self.pickerOptions)})},_changeFile:function(e){var self=this,errMessage='',input=e.target,$input=$(input),accept=$input.attr('accept')||'',maxSize=$input.data('max_size')||$input.data('std')||0;if(input.files.length){for(var i in input.files){if(errMessage){break}
var file=input.files[i];if(!(file instanceof File)){continue}
if(!self._validExtension(file,accept)){errMessage=(self.options.messages.err_extension||'').replace('%s',self.getExtension(file.name))}
if(!errMessage&&file.size>(parseFloat(maxSize)*1048576)){errMessage=(self.options.messages.err_size||'').replace('%s',maxSize)}}}
$input.closest('.for_file').toggleClass('check_wrong',!(self.isFileValid=!errMessage)).find('.w-form-row-state').html(errMessage||self.options.messages.err_empty)},_submit:function(e){e.preventDefault();var self=this;self.$message.usMod('type',!1).html('');if(self.$submit.hasClass('loading')||!self._requiredValidation()||!self.isFileValid){return}
self.$submit.addClass('loading');$.ajax({type:'POST',url:self.options.ajaxurl,data:_window.FormData?new FormData(self.$form[0]):self.$form.serialize(),cache:!1,processData:!1,contentType:!1,dataType:'json',success:function(res){$('.w-form-row.check_wrong',self.$form).removeClass('check_wrong');if(res.success){self.$message.usMod('type','success').html(res.data);$('.w-form-row.not-empty',self.$form).removeClass('not-empty');$('input[type=text], input[type=email], textarea',self.$form).val('');self.$form.trigger('usCformSuccess',res).get(0).reset()}else{if($.isPlainObject(res.data)){for(var fieldName in res.data){if(fieldName==='empty_message'){$resultField.usMod('type','error');continue}
$('[name="'+fieldName+'"]',self.$form).closest('.w-form-row').addClass('check_wrong').find('.w-form-row-state').html(res.data[fieldName].error_message||'');}}else{self.$message.usMod('type','error').html(res.data)}}},complete:function(){self.$submit.removeClass('loading')}})}});$.fn.wForm=function(){return this.each(function(){$(this).data('wForm',new $us.WForm(this))})};$('.w-form.for_cform').wForm();$(_document).on('focus blur','.w-form-row-field:not(.for_date) input, .w-form-row-field textarea',function(e){$(e.target).closest('.w-form-row').toggleClass('focused',e.type=='focusin')})}(jQuery)